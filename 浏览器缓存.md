<!-- 浏览器强制刷新缓存的原理： -->
强制刷新缓存的原理是设置cache-control 为no-cache，这个行为会被chrome devTools 隐藏，但可以用charles抓包看到

网站的缓存设置一般会将入口的html文件设置cache-control 为no-cache，其他的文件设置max-age。这样入口文件会用本地缓存但每次都协商，能及时更新，而其他资源不会发请求，能减少服务器压力；
当需要更新的时候，html文件协商发现有更新则会下载新html，这时候关联了其他hash文件，浏览器就会下载新的，不会走之前的文件缓存

浏览器的清空缓存并强制刷新功能也是去清掉本地缓存再去协商，保证拿到最新的资源

<!-- 关于network的Size列出现的三种情况： -->
1⃣️ from memory cache
2⃣️ from disk cache 
3⃣️ 资源本身大小

<!-- 三级缓存原理： -->
先查找内存，如果内存中存在，从内存中加载；
如果内存中未查到，选择硬盘获取，如果硬盘里存在，从硬盘中加载；
如果硬盘中没查到，就进行网络请求，加载到的资源缓存到硬盘和内存

<!-- 缓存状态码： -->
1⃣️ 200 from memory cache：不访问服务器，一般是已经加载过该资源且缓存在了内存中，直接从内存中读取缓存，浏览器关闭后，资源将被释放，再次打开相同的页面时，不会出现from memory cache
2⃣️ 200 from disk cache：不访问服务器，已经在之前的某个时间加载过该资源，直接从硬盘中读取缓存，关闭浏览器后，数据依然存在，此资源不会随着该页面的关闭而释放资源，下次打开仍会是from disk cache （解决方法：手动清除浏览器缓存）
3⃣️ 200 大小（3.4k）：访问服务器，size显示为实际资源的大小
4⃣️ 304 Not Modified： 访问服务器，发现数据没有更新，服务器返回此状态码。然后从缓存中读取数据

<!-- 浏览器缓存机制： -->

<!-- 缓存行为 -->
浏览器每次发起请求，都会先在浏览器缓存中查找该请求的结果以及缓存标识
浏览器每次拿到返回的请求结果都会将该结果和缓存标识存入浏览器缓存中

强制缓存优先于协商缓存进行，若强缓存生效则直接使用强缓存，若强缓存不生效则进行协商缓存
协商缓存由服务器决定是否使用缓存；若协商缓存失效，那么就返回200，重新返回资源和缓存标识，再存入浏览器缓存中；若协商缓存生效则返回304，继续使用缓存。



<!-- 缓存位置 -->
1. service worker：运行在浏览器背后的独立线程，无法直接访问dom，但可以用来做离线缓存、消息推送和网络代理。传输协议必须为https
2. memory cache：内存中的缓存
3. disk cache：存储在硬盘中的缓存
4. push cache（推送缓存）：http2 中的内容 （此功能在chrome106版本后不可用）

<!-- 缓存过程 -->
浏览器第一次加载资源，服务器返回200，浏览器将资源文件从服务器上请求下载下来，并把response header及该请求的返回时间一并缓存；
下一次加载资源时，先比较当前时间和上一次返回200时的时间差，如果没有超过cache-control设置的max-age，则没有过期，命中强缓存，不发请求直接从本地缓存读取该文件（如果浏览器不支持HTTP1.1，则用expires判断是否过期）；如果时间过期，则向服务器发送header带有If-None-Match和If-Modified-Since的请求
服务器收到请求后，优先根据 Etag 的值判断被请求的文件有没有做修改，Etag 值一致则没有修改，命中协商缓存，返回304；如果不一致则有改动，直接返回新的资源文件带上新的Etag值并返回200；
如果服务器收到的请求没有 Etag 值，则将 If-Modified-Since 和被请求文件的最后修改时间做比对，一致则命中协商缓存，返回304；不一致则返回新的 last-modified 和文件并返回200；

<!-- no-cache和no-store的区别 -->
no-cache和no-store 都可以在请求和响应中使用
no-store 是真正的不进行任何缓存，告知服务器和缓存浏览器，请求/响应的内容里有机密信息
当no-cache 在请求头中使用时，表示强制使用协商缓存
当no-cache 在响应头中被返回时，表示缓存服务器不能对资源进行缓存，客户端可以缓存资源，但每次使用缓存资源前都需要先向服务器确认有效性

<!-- 用户行为对浏览器缓存的影响 -->
打开网页，输入地址：查找disk cache中是否有匹配。若有则使用，若没有则发送网络请求。
普通刷新（F5）：不使用强缓存，会判断协商缓存，且因为tab并没有关闭，因此memory cache是可用的，会被优先匹配，其次才是disk cache。
强制刷新（ctrl+F5）：浏览器不使用缓存，服务器直接返回200和最新内容
